{"version":3,"sources":["..\\..\\..\\..\\assets\\Script/assets\\Script\\hero.js"],"names":["cc","Class","extends","Component","properties","num","default","type","Label","scene","serializable","sprite","Sprite","spriteList","SpriteFrame","onLoad","string","window","Global_heroRadius","node","width","manager","director","getCollisionManager","enabled","body","getComponent","RigidBody","radius","getChildByName","flag","spriteFrame","selectIndex","onSetImpules","impulse","point","speed","onGetSpeedFromWorldPoint","getPosition","x","applyLinearImpulse","p","Math","abs","onChangeRotation","rotation","onRecoveryRotation","getLinearVelocityFromWorldPoint","onSetHeroSpeed","linearVelocity","v2","Global_VelocityForY","init","Global_suqareWidth","onBeginContact","contact","selfCollider","otherCollider","isCrashing","onEndContact","Number","onShowSelectAction","Global_isCrashWithSquare","crashNode","onPreSolve","crashFlag","getHeroLength","length","setHeroLength","number","String","onGetHeroPosInRoot","wordPoint","parent","convertToWorldSpaceAR","resultPoint","convertToNodeSpaceAR","Global_RootHeroPos","start","count","patchGameOver","colorTimes","update","dt","Global_isInvincible","floor","color","Color","headColor","Global_moveTouchPosition","Global_heroMoving","Global_heroBodyArr","Global_heroPositionsArray","i","index","setPosition","pop","lateUpdate","Global_oldPoint","y","speedX","speedY","pos","cos","atan2","sin","unshift"],"mappings":"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","file":"hero.js","sourceRoot":"..\\..\\..\\..\\assets\\Script","sourcesContent":["\n\ncc.Class({\n    extends: cc.Component,\n\n    properties: {\n        num:{\n            default: null,\n            type: cc.Label\n        },\n\n        scene:{\n            default: null,\n            serializable: false\n        }, \n        \n        sprite: cc.Sprite,\n\n        spriteList:{\n            default: [],\n            type:[cc.SpriteFrame]\n        },\n    },\n\n\n    onLoad () {\n        this.num.string = 4;\n        window.Global_heroRadius = this.node.width*0.75;           //hero的半径\n\n        //碰撞事件 - 测试\n        var manager = cc.director.getCollisionManager();\n        manager.enabled = true;\n        \n        this.body = this.node.getComponent(cc.RigidBody);\n        this.node.getComponent('cc.PhysicsCircleCollider').radius = this.node.getChildByName('heroSprite').getComponent(cc.Sprite).node.width*0.1;\n\n        \n        this.flag = 8;\n\n        //根据选择皮肤的编号进行更换\n        this.sprite.spriteFrame = this.spriteList[window.selectIndex];\n    },\n\n    // 施加一个冲量到刚体上指定的点上，这个点是世界坐标系下的一个点\n    onSetImpules: function(impulse, point){\n        var speed = this.onGetSpeedFromWorldPoint(this.node.getPosition());\n        //改变方向的时候的加速处理\n        if((speed.x > 0 && impulse.x < 0) || (speed.x < 0 && impulse.x > 0)){\n            this.body.applyLinearImpulse(cc.p(0,0), point);\n        }\n        if(Math.abs(speed.x) > 450) return;\n        this.body.applyLinearImpulse(impulse, point);\n\n        \n    },\n\n    //改变头部就角度\n    onChangeRotation: function(num){\n        //spriteNode\n        let rotation = this.node.getChildByName('heroSprite').getComponent(cc.Sprite).node.rotation;\n        if(rotation < 0){\n            if(num >0){\n                this.node.getChildByName('heroSprite').getComponent(cc.Sprite).node.rotation += num*2;\n            }\n        }else if(rotation > 0){\n            if(num < 0){\n                this.node.getChildByName('heroSprite').getComponent(cc.Sprite).node.rotation += num*2;\n            }\n        }\n        if(Math.abs(this.node.getChildByName('heroSprite').getComponent(cc.Sprite).node.rotation) >= 60) return;\n        this.node.getChildByName('heroSprite').getComponent(cc.Sprite).node.rotation += num;\n    },\n    //摆正头部\n    onRecoveryRotation: function(){\n        let rotation = this.node.getChildByName('heroSprite').getComponent(cc.Sprite).node.rotation;\n        if(rotation > 5){\n            this.node.getChildByName('heroSprite').getComponent(cc.Sprite).node.rotation -= 5;\n        }else if(rotation < -5){\n            this.node.getChildByName('heroSprite').getComponent(cc.Sprite).node.rotation += 5;\n        }else{\n            this.node.getChildByName('heroSprite').getComponent(cc.Sprite).node.rotation = 0;\n        }\n    },\n\n    //获取hero在某点的速度\n    onGetSpeedFromWorldPoint: function(point){\n        var speed = this.body.getLinearVelocityFromWorldPoint(point);\n        return speed;\n    },\n\n    onSetHeroSpeed: function(speed){\n        this.body.linearVelocity = cc.v2(speed.x, window.Global_VelocityForY);\n        //cc.log(this.body.linearVelocity );\n        var rotation = speed.x/100 * 2;\n        this.onChangeRotation(rotation);\n        //cc.log(window.Global_VelocityForY);\n    },\n\n    init: function(node){\n        this.scene = node;\n        this.node.getComponent('cc.CircleCollider').radius = window.Global_suqareWidth/5.715;\n    },\n/**************************  刚体的碰撞事件处理 ***************************/\n    // 只在两个碰撞体开始接触时被调用一次\n    onBeginContact: function (contact, selfCollider, otherCollider) {\n        this.isCrashing = true;\n        this.flag = 6;\n    },\n\n    // 只在两个碰撞体结束接触时被调用一次\n    onEndContact: function (contact, selfCollider, otherCollider) {\n        if(Number(this.num.string) == 0){\n            this.scene.onShowSelectAction();\n        }\n        window.Global_isCrashWithSquare = false;\n        \n        this.isCrashing = false;\n        this.crashNode = null;\n    },\n\n    // 每次将要处理碰撞体接触逻辑时被调用\n    onPreSolve: function (contact, selfCollider, otherCollider) {\n        //与障碍物发生侧碰\n            //cc.log(crashFlag);\n            if(crashFlag.x > 0.85){//向右\n                //cc.log(\"isCrash-----------\");\n                if(this.isCrashing){\n                    this.isCrashing = false;\n                }\n            }else if(crashFlag.x < -0.85){//向左\n                if(this.isCrashing){\n                    this.isCrashing = false;\n                }\n            }\n    },\n\n    //获取当前HERO的长度\n    getHeroLength: function(){\n        var length = Number(this.num.string);\n        return length;\n    },\n\n    //获取当前HERO的长度\n    setHeroLength: function(number){\n        this.num.string = String(Number(this.num.string) + number);\n    },\n\n    //获取hero在根节点坐标系下的坐标\n    onGetHeroPosInRoot: function(){\n        // 先获取自身的位置\n        const point = this.node.getPosition();   \n        // 再获取其所在的世界坐标系的位置\n        const wordPoint = this.node.parent.convertToWorldSpaceAR(point); \n        // 转换到目标结点系的相应位置\n        const resultPoint = this.node.parent.parent.convertToNodeSpaceAR(wordPoint);\n        window.Global_RootHeroPos = resultPoint;\n        return resultPoint;\n    },\n\n    start () {\n        //this.node.opacity = 0;\n\n        this.count = 0;\n        window.Global_heroRadius *= 1.4;\n        //是否已经发出去游戏结束\n        this.patchGameOver = false;\n        this.crashNode = null;\n\n        //颜色改变计数器\n        this.colorTimes = 0;\n    },\n\n    update: function(dt) {\n        if(window.Global_isInvincible){\n            this.colorTimes += 0.1;\n            var flag = Math.floor(this.colorTimes) % 3;\n            var color = {};\n            if(flag == 0){\n                color = new cc.Color(255, 0, 0);\n            }else if(flag == 1){\n                color = new cc.Color(0, 255, 0);\n            }else{\n                color = new cc.Color(0, 0, 255);\n            }\n            this.sprite.node.color = color;\n            window.headColor = color;\n        }else if(this.sprite.node.color != new cc.Color(255, 255, 255)){\n            this.sprite.node.color = new cc.Color(255, 255, 255)\n            this.colorTimes = 0;\n            window.headColor = new cc.Color(255, 255, 255);\n        }\n        if(window.Global_moveTouchPosition.length == 0 || !window.Global_heroMoving){\n            this.onRecoveryRotation();\n        }\n        //根据痕迹进行移动\n        if(window.Global_isCrashWithSquare  && window.Global_heroBodyArr.length > 0)\n        if(window.Global_heroPositionsArray.length > window.Global_heroRadius * (window.Global_heroBodyArr.length+1) ||\n             window.Global_heroBodyArr[0].getPosition() != window.Global_heroPositionsArray[Math.floor(1*window.Global_heroRadius)]){\n\n            for(var i = 0; i < window.Global_heroBodyArr.length; ++i){\n                var index = Math.floor((i+1)*window.Global_heroRadius);\n                if(window.Global_heroPositionsArray[index]){\n                    var x = window.Global_heroPositionsArray[index];\n                    window.Global_heroBodyArr[i].setPosition(x);\n                }\n                if(window.Global_heroPositionsArray.length > window.Global_heroRadius * (window.Global_heroBodyArr.length+1)){\n                    window.Global_heroPositionsArray.pop();\n                }\n            }\n        }\n    },\n    lateUpdate: function(){\n        //每隔一个像素记录一次hero的位置\n        if(window.Global_oldPoint && (window.Global_oldPoint.x != this.onGetHeroPosInRoot.x || window.Global_oldPoint.y != this.onGetHeroPosInRoot().y )){\n            var speedX = Math.abs(window.Global_oldPoint.x-this.onGetHeroPosInRoot().x);\n            var speedY = Math.abs(window.Global_oldPoint.y-this.onGetHeroPosInRoot().y);\n            var speed = speedX > speedY ? speedX: speedY;\n    \n            var pos = this.onGetHeroPosInRoot();\n            //X方向坐标的改变\n            for(var i = 0; i < speed; ++i){\n                var x = i * Math.cos(Math.atan2(pos.y - window.Global_oldPoint.y, pos.x - window.Global_oldPoint.x)) + window.Global_oldPoint.x;\n                var y = i * Math.sin(Math.atan2(pos.y - window.Global_oldPoint.y, pos.x - window.Global_oldPoint.x)) + window.Global_oldPoint.y;\n\n                if(!window.Global_isCrashWithSquare || speedX != 0)\n                window.Global_heroPositionsArray.unshift(cc.p(x , y));\n            }\n            if(!window.Global_isCrashWithSquare || speedX != 0 || this.count ==  2){\n                this.count = 0;\n                window.Global_heroPositionsArray.unshift(this.onGetHeroPosInRoot());\n            }\n            window.Global_oldPoint = this.onGetHeroPosInRoot();  \n            this.count++;   \n        }\n        if(!window.Global_oldPoint){\n            window.Global_oldPoint = this.onGetHeroPosInRoot();\n        }\n\n        //根据痕迹进行移动\n        if(!window.Global_isCrashWithSquare && window.Global_heroBodyArr.length > 0)\n        if(window.Global_heroPositionsArray.length > window.Global_heroRadius * (window.Global_heroBodyArr.length+1) ||\n             window.Global_heroBodyArr[0].getPosition() != window.Global_heroPositionsArray[Math.floor(1*window.Global_heroRadius)]){\n            for(var i = 0; i < window.Global_heroBodyArr.length; ++i){\n                var index = Math.floor((i+1)*window.Global_heroRadius);\n                     \n                if(window.Global_heroPositionsArray[index]){\n                    var x = window.Global_heroPositionsArray[index];\n                    window.Global_heroBodyArr[i].setPosition(x);\n                }\n                if(window.Global_heroPositionsArray.length > window.Global_heroRadius * (window.Global_heroBodyArr.length+1)){\n                    window.Global_heroPositionsArray.pop();\n                }\n            }\n        }\n    },\n});\n\n"]}